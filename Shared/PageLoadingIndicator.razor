@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@implements IAsyncDisposable

@* Component này sẽ quản lý việc hiển thị thanh tiến trình tải trang *@

@code {
    private IJSObjectReference? module;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Import file JavaScript và khởi tạo các trình lắng nghe sự kiện
            module = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/interop.js");
            if (module is not null)
            {
                await module.InvokeVoidAsync("setupNavigationProgressListener");
            }
            Navigation.LocationChanged += OnLocationChanged;
        }
    }

   
    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        if (module is not null)
        {
            
            try
            {
                var task = module.InvokeVoidAsync("stopProgressBar");
            }
            catch (JSDisconnectedException) { }
        }
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        Navigation.LocationChanged -= OnLocationChanged;
        if (module is not null)
        {
            await module.DisposeAsync();
        }
    }
}
